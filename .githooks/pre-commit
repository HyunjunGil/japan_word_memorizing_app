#!/bin/bash
# Pre-commit hook: results í´ë”ì˜ JSON íŒŒì¼ì´ ë³€ê²½ë˜ë©´ manifest.json ìë™ ì—…ë°ì´íŠ¸

# results/ í´ë”ì˜ .json íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (manifest.json ì œì™¸)
RESULTS_CHANGED=$(git diff --cached --name-only | grep -E '^results/.*\.json$' | grep -v 'manifest.json')

if [ -n "$RESULTS_CHANGED" ]; then
  echo "ğŸ“ results í´ë”ì˜ JSON íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."
  echo "ğŸ”„ manifest.json ìë™ ì—…ë°ì´íŠ¸ ì¤‘..."
  
  # Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
  python3 update_manifest.py
  
  # ì‹¤í–‰ ê²°ê³¼ í™•ì¸
  if [ $? -eq 0 ]; then
    # manifest.jsonì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
    if git diff --name-only | grep -q "results/manifest.json"; then
      echo "âœ… manifest.jsonì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
      echo "ğŸ“¦ manifest.jsonì„ ì»¤ë°‹ì— ì¶”ê°€í•©ë‹ˆë‹¤..."
      git add results/manifest.json
    else
      echo "â„¹ï¸  manifest.json ë³€ê²½ì‚¬í•­ ì—†ìŒ"
    fi
  else
    echo "âŒ manifest.json ì—…ë°ì´íŠ¸ ì‹¤íŒ¨"
    exit 1
  fi
fi

exit 0

