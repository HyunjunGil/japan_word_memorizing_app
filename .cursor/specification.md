# 일본어 단어장 (japan_wordbook.html) 명세서

## 개요
일본어 단어 학습을 위한 웹 애플리케이션입니다. 플래시카드 방식의 평가 모드와 테이블 방식의 공부 모드를 제공하며, 가중치 기반 반복 학습 시스템을 구현하고 있습니다.

## 기술 스택
- **HTML5**: 단일 파일 구조
- **CSS3**: 반응형 디자인 (모바일 최적화)
- **JavaScript (Vanilla)**: 클라이언트 사이드 로직
- **세션 기반**: 페이지 새로고침 시 모든 데이터 초기화

## 파일 구조
```
japan_wordbook.html (1877 lines)
├── <head>
│   ├── 메타 태그 (UTF-8, viewport)
│   └── <style> (689 lines) - 인라인 CSS
├── <body>
│   ├── HTML 구조 (692-772 lines)
│   └── <script> (774-1875 lines) - JavaScript 로직
```

## 주요 화면 구성

### 1. 파일 선택 화면 (`fileSelectionScreen`)
- **모드 선택**: 평가하기 / 공부하기
- **파일 업로드**: JSON 파일 다중 업로드
- **단어묶음 목록**: 체크박스로 선택
- **전체선택/전체해제** 버튼
- **학습 시작** 버튼

### 2. 플래시카드 화면 (`flashcardScreen`)
- **평가하기 모드 전용**
- 카드 형태의 단어 표시
- 가중치 배지 표시
- 이전/다음 네비게이션
- 정답 확인 기능

### 3. 공부하기 테이블 화면 (`studyTableScreen`)
- **공부하기 모드 전용**
- 테이블 형태로 모든 단어 표시
- ID, 일본어 표기, 발음, 의미 컬럼
- 스크롤 가능한 고정 헤더

## 데이터 구조

### 단어셋 (WordSet)
```javascript
{
    "fileName": "page_01",  // 파일명 (고유 식별자)
    "words": [
        {
            "id": 1,                    // 단어 ID
            "japanese": "改札",         // 일본어 표기
            "pronunciation": "かいさつ", // 발음 (히라가나/가타카나)
            "meaning": "개찰"           // 한국어 의미
        },
        // ...
    ]
}
```

### 가중치 시스템
- **키 형식**: `{fileName}_{wordId}` (예: `page_01_1`)
- **값 범위**: 1 ~ 5 (기본값: 1)
- **저장 위치**: 메모리 (세션 중에만 유지, 페이지 새로고침 시 초기화)

### 전역 변수
```javascript
let wordSets = [];           // 모든 단어셋 배열
let selectedWords = [];      // 선택된 단어들 (학습용)
let currentWordIndex = -1;   // 현재 단어 인덱스
let wordHistory = [];        // 학습 히스토리 (스택 방식)
let currentQuestion = null;  // 현재 문제 정보
let answerShown = false;     // 정답 표시 여부
let weights = {};           // 가중치 객체
let studyMode = 'quiz';     // 'quiz' or 'study'
let buttonAlignment = 'center'; // 'left', 'center', 'right'
```

### 히스토리 구조 (스택 방식)
- **저장 방식**: 스택(LIFO) 방식으로 관리
- **저장 데이터**: 단어 객체 + 문제 유형 정보
  ```javascript
  {
      ...word,              // 원본 단어 데이터
      questionType: 'japanese' | 'meaning',  // 문제 유형
      questionLabel: '일본어 표기' | '뜻'    // 문제 라벨
  }
  ```
- **동작**: 이전으로 갔다가 다시 다음을 누르면 그 사이의 히스토리가 제거되고 새 단어 추가

## 데이터 저장 방식

### 메모리 기반 (세션 전용)
- **단어셋**: `wordSets` 배열에 저장 (페이지 로드 시 `DEFAULT_WORD_SETS`로 초기화)
- **가중치**: `weights` 객체에 저장 (학습 시작 시 모든 단어의 가중치를 1로 초기화)
- **특징**: 페이지 새로고침 시 모든 데이터가 초기화됨

### 초기화 로직
1. 페이지 로드 시 `DEFAULT_WORD_SETS`를 `wordSets`에 복사
2. 학습 시작 시 선택된 단어들의 가중치를 모두 1로 초기화
3. 세션 중에만 가중치가 업데이트됨 (페이지 새로고침 시 초기화)

## 주요 기능

### 1. 파일 관리
- **`handleFileUpload(event)`**: JSON 파일 업로드 및 파싱
  - 중복 파일명 체크 (덮어쓰기)
  - 메모리에만 저장 (세션 중에만 유지)
  
- **`renderFileList()`**: 파일 목록 렌더링
  - 숫자 기반 자연 정렬 (page_01, page_02, ...)
  - 단어 개수 표시
  - 체크박스 상태 관리

### 2. 모드 선택
- **`selectMode(mode)`**: 학습 모드 변경
  - `'quiz'`: 평가하기 (플래시카드)
  - `'study'`: 공부하기 (테이블)
  - 공부하기 모드로 변경 시 모든 체크박스 해제

### 3. 파일 선택
- **`toggleFileSelection(index, event)`**: 파일 선택 토글
  - 평가하기 모드: 다중 선택 가능
  - 공부하기 모드: 단일 선택만 가능
  
- **`selectAll()`**: 전체 선택 (평가하기 모드만)
- **`deselectAll()`**: 전체 해제

### 4. 학습 시작
- **`startStudy()`**: 학습 세션 시작
  - 선택된 단어들을 `selectedWords`에 병합
  - 각 단어에 `fileName`, `weightKey` 추가
  - 가중치 초기화 (모든 선택된 단어의 가중치를 1로 설정)
  - 모드에 따라 다른 화면 표시
    - 평가하기: `flashcardScreen`
    - 공부하기: `studyTableScreen`

### 5. 가중치 기반 학습
- **`getWeightedRandomWord()`**: 가중치 기반 랜덤 단어 선택
  - 총 가중치 합 계산
  - 랜덤 값으로 가중치 구간 선택
  - 가중치가 높을수록 더 자주 출제

- **가중치 업데이트 규칙**:
  - **평가하기 모드**:
    - 정답 확인 후: +1 (최대 5)
    - 정답 확인 없이 넘어감: -1 (최소 1)
  - **공부하기 모드**:
    - 항상 +1 (최대 5)

### 6. 플래시카드 (평가하기 모드)
- **`nextCard()`**: 다음 카드 표시
  - 이전 단어 가중치 업데이트
  - **스택 방식**: 현재 위치 이후의 히스토리 제거 (이전으로 갔다가 다시 다음을 누른 경우)
  - 새 단어 가중치 기반 선택
  - 문제 유형 랜덤 선택 (일본어 표기 또는 뜻)
  - 단어 객체에 `questionType`, `questionLabel` 속성 추가
  - 히스토리에 추가
  
- **`previousCard()`**: 이전 카드로 이동
  - 히스토리 기반 네비게이션 (스택 방식)
  - 저장된 문제 유형 그대로 표시
  
- **`displayCard()`**: 카드 내용 표시
  - 모드에 따라 다른 함수 호출
  
- **`displayQuizMode(word)`**: 평가 문제 표시
  - **문제 유형**: 일본어 표기, 뜻 (2가지만, 발음 문제는 제외)
    - 일본어 표기 → 발음/의미 맞추기
    - 뜻 → 일본어 표기/발음 맞추기
  - **히스토리 기반 문제 유형 사용**: 저장된 `questionType`이 있으면 사용, 없으면 랜덤 선택 후 저장
  - **카드 높이 유지**: 답 부분도 미리 렌더링하되 `hidden` 클래스로 숨김 처리 (공간은 유지)
  - 정답 확인 버튼을 "?" 아이콘으로 초기화하고 항상 표시
  
- **`showAnswer()`**: 정답 표시/숨기기 토글
  - 정답이 숨겨져 있을 때: 정답 표시, 가중치 +1, 버튼 아이콘을 "✓"로 변경
  - 정답이 보여져 있을 때: 정답 숨김, 버튼 아이콘을 "?"로 변경
  - 버튼은 사라지지 않고 계속 표시됨 (토글 가능)
  - 가중치는 정답을 처음 보여줄 때만 증가
  
- **버튼 디자인**:
  - 모든 버튼이 동그라미 형태의 아이콘 버튼
  - 이전 버튼: ◀ (왼쪽 화살표)
  - 정답 확인 버튼: ? (물음표, 정답 표시 시 ✓)
  - 다음 버튼: ▶ (오른쪽 화살표)

### 7. 공부하기 모드
- **`displayStudyTable(wordSet)`**: 테이블 형태로 모든 단어 표시
  - ID, 일본어, 발음, 의미 컬럼
  - 스크롤 가능한 고정 헤더
  
- **`displayStudyMode(word)`**: 플래시카드 형태로 모든 정보 표시
  - 일본어 표기를 메인으로 표시
  - 발음, 의미 함께 표시

### 8. 네비게이션
- **`goHome()`**: 처음 화면으로 돌아가기
  - 확인 다이얼로그
  - 모든 화면 숨김
  
- **`changeWordSet()`**: 단어셋 변경
  - 확인 다이얼로그
  - 파일 선택 화면으로 복귀

### 9. 버튼 정렬 설정
- **`toggleAlignmentMenu()`**: 정렬 메뉴 표시/숨김 토글
  - 설정 버튼 클릭 시 메뉴 표시/숨김
  
- **`setButtonAlignment(alignment)`**: 버튼 정렬 설정
  - `'left'`: 왼쪽 정렬
  - `'center'`: 중앙 정렬 (기본값)
  - `'right'`: 오른쪽 정렬
  - 선택한 옵션에 따라 `card-controls` 클래스 변경
  - 메뉴 외부 클릭 시 자동으로 닫힘

### 10. 유틸리티
- **`updateButtons()`**: 버튼 상태 업데이트 (이전 버튼 활성화/비활성화)
- **`init()`**: 페이지 로드 시 초기화
  - `DEFAULT_WORD_SETS`를 `wordSets`에 복사
  - 파일 목록 렌더링

## CSS 구조

### 주요 스타일
- **그라데이션 배경**: 보라색 계열 (`#667eea` → `#764ba2`)
- **카드 디자인**: 둥근 모서리, 그림자 효과
- **반응형 디자인**: 
  - 모바일 (≤768px): 세로 레이아웃, 작은 폰트
  - 작은 모바일 (≤480px): 더 작은 폰트, 패딩 축소

### 주요 클래스
- `.container`: 메인 컨테이너 (최대 너비 600px)
- `.header`: 상단 헤더 (그라데이션 배경)
- `.card`: 플래시카드 컨테이너
- `.study-table`: 공부하기 테이블
- `.hidden`: 숨김 처리 (display: none)
- `.card-answer.hidden`: 답 영역 숨김 처리 (공간은 유지, visibility: hidden 사용)
- `.btn-primary`, `.btn-secondary`: 버튼 스타일
- `.btn-icon`: 동그라미 아이콘 버튼 (이전: ◀, 정답 확인: ?, 다음: ▶)
- `.card-controls.align-left`, `.card-controls.align-center`, `.card-controls.align-right`: 버튼 정렬 클래스
- `.settings-button`: 설정 버튼 (카드 왼쪽 상단)
- `.alignment-menu`: 버튼 정렬 선택 메뉴

## 학습 흐름

### 평가하기 모드
1. 파일 선택 (다중 선택 가능)
2. 학습 시작
3. 가중치 기반 랜덤 단어 선택
4. 문제 유형 랜덤 선택 (일본어 표기 또는 뜻)
5. 문제 표시 (단어 + 문제 유형을 히스토리에 저장)
6. 정답 확인 또는 바로 넘어가기
7. 가중치 업데이트
8. 다음 단어 선택 (3번으로)
9. **이전 버튼**: 저장된 문제 유형 그대로 표시 (스택 방식)
10. **이전으로 갔다가 다시 다음**: 그 사이의 히스토리 제거 후 새 단어 추가

### 공부하기 모드
1. 파일 선택 (단일 선택만 가능)
2. 학습 시작
3. 테이블 형태로 모든 단어 표시
4. 스크롤하여 전체 단어 확인

## 특징 및 제약사항

### 특징
- ✅ 가중치 기반 반복 학습 (SRS 유사, 세션 중에만 유지)
- ✅ 두 가지 학습 모드 제공
- ✅ 반응형 디자인 (모바일 최적화)
- ✅ 기본 단어셋 내장 (page_01, page_02)
- ✅ JSON 파일 업로드 지원
- ✅ 간단한 구조 (영구 저장 없음)
- ✅ 카드 높이 일정 유지 (정답 확인 전후 동일한 높이)
- ✅ 정답 확인/숨기기 토글 기능 (버튼을 여러 번 클릭하여 정답 표시/숨김 가능)
- ✅ 동그라미 아이콘 버튼 디자인 (이전: ◀, 정답 확인: ?/✓, 다음: ▶)
- ✅ 버튼 정렬 선택 기능 (왼쪽/중앙/오른쪽 정렬 선택 가능)
- ✅ 스택 방식 히스토리 관리 (이전으로 갔다가 다시 다음을 누르면 그 사이 히스토리 제거)
- ✅ 문제 유형 히스토리 저장 (이전 버튼 클릭 시 같은 문제 유형 표시)

### 제약사항
- ⚠️ 단일 HTML 파일 구조 (코드 분리 없음)
- ⚠️ 서버 없이 동작 (클라이언트 사이드만)
- ⚠️ 가중치 범위: 1~5 (고정)
- ⚠️ 공부하기 모드는 단일 파일만 선택 가능
- ⚠️ 발음 문제 유형 제외 (일본어 표기, 뜻 문제만 출제)
- ⚠️ 페이지 새로고침 시 모든 학습 데이터 초기화 (가중치, 히스토리 등)

## 확장 가능성

### 개선 가능한 영역
1. **가중치 시스템**: 범위 확장, 감쇠율 조정
2. **통계 기능**: 학습 진행률, 정답률 추적 (세션 중)
3. **필터링**: 가중치별, 파일별 필터
4. **검색 기능**: 단어 검색
5. **데이터 영구 저장**: LocalStorage 또는 IndexedDB 추가 (선택적)
6. **다크 모드**: 테마 전환
7. **애니메이션**: 카드 플립 효과
8. **오디오 재생**: 발음 듣기 기능

## 코드 품질

### 장점
- ✅ 명확한 함수 분리
- ✅ 주석이 적절히 포함
- ✅ 반응형 디자인 구현
- ✅ 에러 처리 (파일 업로드)

### 개선 필요
- ⚠️ 전역 변수 다수 사용
- ⚠️ 이벤트 핸들러 인라인 사용
- ⚠️ 매직 넘버 (가중치 최대값 5)
- ⚠️ 하드코딩된 기본 데이터
- ⚠️ 데이터 영구 저장 없음 (세션 종료 시 모든 데이터 손실)

## 데이터 흐름

```
초기화 (init)
  ↓
DEFAULT_WORD_SETS를 wordSets에 복사
  ↓
파일 목록 렌더링 (renderFileList)
  ↓
[사용자 액션]
  ↓
파일 선택 → 학습 시작 (startStudy)
  ↓
가중치 초기화 (모든 단어를 1로 설정)
  ↓
단어 선택 및 화면 전환
  ↓
[평가하기] 
  - 가중치 기반 랜덤 단어 선택
  - 문제 유형 랜덤 선택 (일본어 표기 또는 뜻)
  - 단어 + 문제 유형을 히스토리에 저장 (스택 방식)
  - 문제 표시 → 정답 확인 → 가중치 업데이트 (메모리)
  - 이전 버튼: 저장된 문제 유형 그대로 표시
  - 이전으로 갔다가 다시 다음: 그 사이 히스토리 제거 후 새 단어 추가
  ↓
[공부하기] 테이블 표시
  ↓
[페이지 새로고침 시 모든 데이터 초기화]
```

## 보안 고려사항
- JSON 파싱 시 에러 처리 필요 (현재 구현됨)
- XSS 방지를 위해 사용자 입력 검증 필요 (현재는 파일 업로드만)
- 데이터가 메모리에만 저장되므로 페이지 종료 시 자동 삭제

## 브라우저 호환성
- ES6+ 문법 사용 (async/await, 화살표 함수 등)
- 모던 브라우저 권장 (Chrome, Firefox, Safari, Edge)
- LocalStorage 불필요 (메모리 기반만 사용)

