<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë³¸ì–´ ë‹¨ì–´ì¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 24px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        #settingsBtn {
            font-size: 28px;
        }
        
        .content {
            padding: 40px;
        }
        
        .file-selection {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .mode-selection {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
        }
        
        .mode-option {
            flex: 1;
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .mode-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .mode-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8e9ff 100%);
        }
        
        .mode-option input[type="radio"] {
            display: none;
        }
        
        .mode-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .mode-description {
            font-size: 14px;
            color: #666;
        }
        
        .mode-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .upload-section {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-section:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }
        
        .upload-section input {
            display: none;
        }
        
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-item:hover {
            background: #e8e9ff;
        }
        
        .file-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .file-item-info {
            flex: 1;
        }
        
        .file-item-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .file-item-count {
            font-size: 12px;
            color: #666;
        }
        
        .selection-controls {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-icon {
            width: 56px;
            height: 56px;
            padding: 0;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-icon.btn-primary {
            flex: 0 0 auto;
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .flashcard {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .card {
            width: 100%;
            min-height: 300px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8e9ff 100%);
            border-radius: 16px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .weight-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .progress-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(118, 75, 162, 0.2);
            color: #764ba2;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .weight-value {
            font-size: 14px;
            color: #764ba2;
        }
        
        .progress-value {
            font-size: 14px;
            color: #667eea;
        }
        
        .card-question {
            font-size: 14px;
            color: #667eea;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .card-content {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        
        .card-answer {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }
        
        .card-answer-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            text-align: center;
        }
        
        .card-answer-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .card-answer-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .study-mode-card {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .study-item {
            padding: 25px 30px;
            background: white;
            border-radius: 12px;
            text-align: center;
        }
        
        .study-item-label {
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .study-item-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        
        .study-item.main {
            background: white;
        }
        
        .study-item.main .study-item-label {
            color: #667eea;
        }
        
        .study-item.main .study-item-value {
            color: #333;
            font-size: 40px;
        }
        
        .card-controls {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
            align-items: center;
        }
        
        .card-controls.align-left {
            justify-content: flex-start;
        }
        
        .card-controls.align-center {
            justify-content: center;
        }
        
        .card-controls.align-right {
            justify-content: flex-end;
        }
        
        .alignment-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
            z-index: 20;
            min-width: 120px;
        }
        
        .alignment-menu.show {
            display: flex;
        }
        
        .alignment-option {
            padding: 10px 15px;
            border: none;
            background: #f8f9ff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            text-align: left;
            transition: all 0.2s;
        }
        
        .alignment-option:hover {
            background: #e8e9ff;
        }
        
        .alignment-option.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .card-controls .btn:not(.btn-icon) {
            flex: 1;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .card-answer.hidden {
            display: flex;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .study-table-info {
            margin-bottom: 15px;
            padding: 12px 16px;
            background: #f8f9ff;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        .study-table-container {
            width: 100%;
            max-height: 600px;
            overflow-y: auto;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            background: white;
        }
        
        .study-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .study-table thead {
            position: sticky;
            top: 0;
            background: #f5f5f5;
            color: #333;
            z-index: 10;
            border-bottom: 2px solid #667eea;
        }
        
        .study-table th {
            padding: 15px;
            text-align: left;
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }
        
        .study-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 16px;
        }
        
        .study-table tbody tr:hover {
            background: #f8f9ff;
        }
        
        .study-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .study-table .id-cell {
            width: 60px;
            text-align: center;
            color: #667eea;
            font-weight: bold;
        }
        
        .study-table .japanese-cell {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .study-table th.japanese-cell {
            font-size: 14px;
        }
        
        .study-table th.id-cell,
        .study-table th.play-cell,
        .study-table th.pronunciation-cell,
        .study-table th.meaning-cell {
            font-size: 14px;
        }
        
        .study-table .play-cell {
            width: 60px;
            text-align: center;
        }
        
        .study-table .play-button {
            background: transparent;
            color: #667eea;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            width: 32px;
            height: 32px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
        }
        
        .study-table .play-button:hover {
            background: #f8f9ff;
            border-color: #667eea;
            color: #764ba2;
        }
        
        .study-table .play-button:active {
            background: #e8e9ff;
        }
        
        .study-table .japanese-cell {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .study-table .pronunciation-cell {
            color: #666;
            font-size: 16px;
        }
        
        .study-table .meaning-cell {
            color: #333;
        }
        
        .study-table .japanese-cell,
        .study-table .pronunciation-cell,
        .study-table .meaning-cell {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }
        
        .study-table .japanese-cell:hover,
        .study-table .pronunciation-cell:hover,
        .study-table .meaning-cell:hover {
            background-color: #f0f0f0;
        }
        
        .study-table .japanese-cell.hidden-text,
        .study-table .pronunciation-cell.hidden-text,
        .study-table .meaning-cell.hidden-text {
            background-color: #e8e8e8;
            color: transparent;
            position: relative;
        }
        
        .study-table .japanese-cell.hidden-text::after,
        .study-table .pronunciation-cell.hidden-text::after,
        .study-table .meaning-cell.hidden-text::after {
            content: 'â€¢â€¢â€¢';
            color: #999;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .study-table th.japanese-cell,
        .study-table th.pronunciation-cell,
        .study-table th.meaning-cell {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }
        
        .study-table th.japanese-cell:hover,
        .study-table th.pronunciation-cell:hover,
        .study-table th.meaning-cell:hover {
            background-color: #e8e9ff;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 100%;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            
            .header {
                padding: 12px 15px;
                flex-wrap: nowrap;
                align-items: center;
            }
            
            .header h1 {
                font-size: 18px;
                flex: 0 1 auto;
                min-width: 0;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                margin-right: 10px;
            }
            
            .header-buttons {
                flex: 0 0 auto;
                gap: 6px;
                margin-top: 0;
                width: auto;
            }
            
            .header-btn {
                padding: 6px 10px;
                font-size: 11px;
                flex: 0 0 auto;
                min-width: auto;
                white-space: nowrap;
            }
            
            #settingsBtn {
                font-size: 22px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .mode-selection {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .mode-option {
                padding: 15px;
            }
            
            .mode-title {
                font-size: 16px;
            }
            
            .mode-description {
                font-size: 12px;
            }
            
            .mode-icon {
                font-size: 28px;
                margin-bottom: 8px;
            }
            
            .upload-section {
                padding: 20px 15px;
            }
            
            .file-list {
                max-height: 50vh;
            }
            
            .file-item {
                padding: 12px;
            }
            
            .file-item input[type="checkbox"] {
                width: 18px;
                height: 18px;
                margin-right: 12px;
            }
            
            .file-item-name {
                font-size: 14px;
            }
            
            .file-item-count {
                font-size: 11px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .card {
                min-height: 250px;
                padding: 25px 15px;
                gap: 15px;
            }
            
            .progress-badge {
                top: 10px;
                left: 10px;
                padding: 4px 10px;
                font-size: 11px;
            }
            
            .weight-badge {
                top: 10px;
                right: 10px;
                padding: 4px 10px;
                font-size: 11px;
            }
            
            .card-question {
                font-size: 12px;
            }
            
            .card-content {
                font-size: 32px;
                word-break: break-word;
            }
            
            .card-answer-item {
                padding: 12px;
            }
            
            .card-answer-value {
                font-size: 20px;
            }
            
            .card-controls {
                flex-direction: row;
                justify-content: center;
                gap: 15px;
            }
            
            .card-controls .btn {
                width: auto;
            }
            
            .card-controls .btn-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .alignment-menu {
                top: 100%;
                right: 0;
                margin-top: 5px;
                min-width: 100px;
                padding: 8px;
            }
            
            .alignment-option {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .study-item {
                padding: 20px 15px;
            }
            
            .study-item-value {
                font-size: 24px;
            }
            
            .study-item.main .study-item-value {
                font-size: 28px;
            }
            
            .study-table-info {
                padding: 10px 12px;
                font-size: 12px;
                margin-bottom: 12px;
            }
            
            .study-table-container {
                max-height: 70vh;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .study-table {
                min-width: 100%;
                font-size: 14px;
            }
            
            .study-table th {
                padding: 10px 8px;
                font-size: 12px;
                white-space: nowrap;
            }
            
            .study-table td {
                padding: 10px 8px;
                font-size: 14px;
            }
            
            .study-table .id-cell {
                width: 40px;
                font-size: 12px;
            }
            
            .study-table .play-cell {
                width: 50px;
            }
            
            .study-table .play-button {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .study-table .japanese-cell {
                font-size: 16px;
            }
            
            .study-table .pronunciation-cell {
                font-size: 13px;
            }
            
            .study-table .meaning-cell {
                font-size: 14px;
            }
            
            .selection-controls {
                flex-direction: column;
            }
            
            .selection-controls .btn-secondary {
                width: 100%;
            }
        }
        
        /* ì‘ì€ ëª¨ë°”ì¼ í™”ë©´ (ì„¸ë¡œ ëª¨ë“œ) */
        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }
            
            .header h1 {
                font-size: 16px;
                margin-right: 8px;
            }
            
            .header-btn {
                padding: 5px 8px;
                font-size: 10px;
            }
            
            #settingsBtn {
                font-size: 20px;
            }
            
            .content {
                padding: 15px 10px;
            }
            
            .card-content {
                font-size: 28px;
            }
            
            .study-table-info {
                padding: 8px 10px;
                font-size: 11px;
                margin-bottom: 10px;
            }
            
            .study-table th,
            .study-table td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .study-table .play-cell {
                width: 45px;
            }
            
            .study-table .play-button {
                width: 26px;
                height: 26px;
                font-size: 11px;
            }
            
            .study-table .japanese-cell {
                font-size: 14px;
            }
            
            .study-table .pronunciation-cell {
                font-size: 11px;
            }
            
            .study-table .meaning-cell {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ì¼ë³¸ì–´ ë‹¨ì–´ì¥</h1>
            <div class="header-buttons">
                <button class="header-btn hidden" id="homeBtn" onclick="goHome()">ì²˜ìŒìœ¼ë¡œ</button>
                <button class="header-btn hidden" id="changeSetBtn" onclick="changeWordSet()">ë‹¨ì–´ì…‹ ë³€ê²½</button>
                <button class="header-btn hidden" id="startQuizBtn" onclick="startQuizFromStudy()">í‰ê°€í•˜ê¸°ë¡œ</button>
                <button class="header-btn hidden" id="settingsBtn" onclick="toggleAlignmentMenu()">âš™</button>
            </div>
            <div class="alignment-menu" id="alignmentMenu">
                <button class="alignment-option" onclick="setButtonAlignment('left')">â¬… ì™¼ìª½</button>
                <button class="alignment-option active" onclick="setButtonAlignment('center')">â¬Œ ì¤‘ì•™</button>
                <button class="alignment-option" onclick="setButtonAlignment('right')">â¡ ì˜¤ë¥¸ìª½</button>
            </div>
        </div>
        
        <div class="content">
            <!-- íŒŒì¼ ì„ íƒ í™”ë©´ -->
            <div id="fileSelectionScreen">
                <div class="file-selection">
                    <!-- ëª¨ë“œ ì„ íƒ -->
                    <div class="mode-selection">
                        <label class="mode-option selected" onclick="selectMode('quiz')">
                            <input type="radio" name="studyMode" value="quiz" checked>
                            <div class="mode-icon">ğŸ“</div>
                            <div class="mode-title">í‰ê°€í•˜ê¸°</div>
                            <div class="mode-description">ëœë¤ ë¬¸ì œë¡œ ì•”ê¸° í…ŒìŠ¤íŠ¸</div>
                        </label>
                        <label class="mode-option" onclick="selectMode('study')">
                            <input type="radio" name="studyMode" value="study">
                            <div class="mode-icon">ğŸ“š</div>
                            <div class="mode-title">ê³µë¶€í•˜ê¸°</div>
                            <div class="mode-description">ëª¨ë“  ì •ë³´ë¥¼ ë³´ë©° í•™ìŠµ</div>
                        </label>
                    </div>
                    
                    <div class="upload-section" onclick="document.getElementById('fileInput').click()">
                        <h3>ğŸ“ JSON íŒŒì¼ ì—…ë¡œë“œ</h3>
                        <p style="margin-top: 10px; color: #666;">í´ë¦­í•˜ì—¬ ë‹¨ì–´ë¬¶ìŒ íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”</p>
                        <input type="file" id="fileInput" accept=".json" multiple onchange="handleFileUpload(event)">
                    </div>
                    
                    <div id="fileListContainer" class="hidden">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>ë‹¨ì–´ë¬¶ìŒ ëª©ë¡</h3>
                            <div>
                                <button class="btn-secondary" style="padding: 8px 16px; margin-right: 10px;" onclick="selectAll()">ì „ì²´ì„ íƒ</button>
                                <button class="btn-secondary" style="padding: 8px 16px;" onclick="deselectAll()">ì „ì²´í•´ì œ</button>
                            </div>
                        </div>
                        <div class="file-list" id="fileList"></div>
                        <div class="selection-controls" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="startStudy()">í•™ìŠµ ì‹œì‘</button>
                        </div>
                    </div>
                    
                    <div id="emptyState" class="empty-state">
                        <h2>ë‹¨ì–´ë¬¶ìŒì´ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p>ìœ„ì˜ ì—…ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ JSON íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>
            </div>
            
            <!-- í”Œë˜ì‹œì¹´ë“œ í™”ë©´ -->
            <div id="flashcardScreen" class="hidden">
                <div class="flashcard">
                    <div class="card">
                        <div class="progress-badge" id="progressBadge">
                            ì§„í–‰ë„: <span class="progress-value" id="progressValue">0 / 0</span>
                        </div>
                        <div class="weight-badge" id="weightBadge">
                            ê°€ì¤‘ì¹˜: <span class="weight-value" id="weightValue">1</span>
                        </div>
                        <div class="card-question" id="questionType"></div>
                        <div class="card-content" id="cardContent"></div>
                        <div class="card-answer hidden" id="cardAnswer"></div>
                    </div>
                    <div class="card-controls align-center" id="cardControls">
                        <button class="btn btn-icon btn-secondary" id="prevBtn" onclick="previousCard()" disabled>â—€</button>
                        <button class="btn btn-icon btn-primary" id="showAnswerBtn" onclick="showAnswer()">?</button>
                        <button class="btn btn-icon btn-primary" id="nextBtn" onclick="nextCard()">â–¶</button>
                    </div>
                </div>
            </div>
            
            <!-- ê³µë¶€í•˜ê¸° í…Œì´ë¸” í™”ë©´ -->
            <div id="studyTableScreen" class="hidden">
                <div class="study-table-container" id="studyTableContainer"></div>
            </div>
        </div>
    </div>

    <script>
        let wordSets = [];
        let selectedWords = [];
        let selectedQuestions = []; // í‰ê°€í•˜ê¸° ëª¨ë“œìš© ë¬¸ì œ ë°°ì—´
        let currentWordIndex = -1;
        let wordHistory = [];
        let currentQuestion = null;
        let answerShown = false;
        let weights = {};
        let studyMode = 'quiz'; // 'quiz' or 'study'
        let buttonAlignment = 'center'; // 'left', 'center', 'right'
        
        // ê¸°ë³¸ ë‹¨ì–´ ë°ì´í„°ëŠ” results í´ë”ì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œ
        const DEFAULT_WORD_SETS = [];
        
        // JSON íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
        async function loadWordSet(fileName) {
            try {
                const response = await fetch(`results/${fileName}.json`);
                if (!response.ok) {
                    console.warn(`íŒŒì¼ ${fileName}.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                    return null;
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.warn(`íŒŒì¼ ${fileName}.json ë¡œë“œ ì‹¤íŒ¨:`, error);
                return null;
            }
        }
        
        // ì´ˆê¸°í™”
        async function init() {
            initVoices();  // ì¼ë³¸ì–´ ìŒì„± ì´ˆê¸°í™”
            
            // results í´ë”ì—ì„œ JSON íŒŒì¼ë“¤ ë¡œë“œ (page_01.json ~ page_29.json)
            const wordSetPromises = [];
            for (let i = 1; i <= 29; i++) {
                const pageNum = String(i).padStart(2, '0');
                wordSetPromises.push(loadWordSet(`page_${pageNum}`));
            }
            
            const loadedWordSets = await Promise.all(wordSetPromises);
            // nullì´ ì•„ë‹Œ ê²ƒë§Œ í•„í„°ë§í•˜ì—¬ ì¶”ê°€
            wordSets = loadedWordSets.filter(set => set !== null);
            
            renderFileList();
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        async function handleFileUpload(event) {
            const files = event.target.files;
            
            for (let file of files) {
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    // ì¤‘ë³µ ì²´í¬ (íŒŒì¼ëª…ìœ¼ë¡œ)
                    const existingIndex = wordSets.findIndex(set => set.fileName === data.fileName);
                    if (existingIndex >= 0) {
                        wordSets[existingIndex] = data;
                    } else {
                        wordSets.push(data);
                    }
                    
                } catch (error) {
                    alert(`íŒŒì¼ "${file.name}" ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            renderFileList();
            event.target.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
        }
        
        // ëª¨ë“œ ì„ íƒ
        function selectMode(mode) {
            studyMode = mode;
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // ê³µë¶€í•˜ê¸° ëª¨ë“œë¡œ ë°”ë€Œë©´ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
            if (mode === 'study') {
                deselectAll();
            }
        }
        
        // íŒŒì¼ ëª©ë¡ ë Œë”ë§
        function renderFileList() {
            const fileList = document.getElementById('fileList');
            const fileListContainer = document.getElementById('fileListContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (wordSets.length === 0) {
                fileListContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            fileListContainer.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            // fileName ìˆœìœ¼ë¡œ ì •ë ¬ (ìˆ«ì ë¶€ë¶„ì„ ê³ ë ¤í•œ ìì—° ì •ë ¬)
            const sortedWordSets = [...wordSets].sort((a, b) => {
                // fileNameì—ì„œ ìˆ«ì ë¶€ë¶„ ì¶”ì¶œ
                const numA = parseInt(a.fileName.match(/\d+/)?.[0] || '0', 10);
                const numB = parseInt(b.fileName.match(/\d+/)?.[0] || '0', 10);
                return numA - numB;
            });
            
            fileList.innerHTML = sortedWordSets.map((set, index) => {
                // ì›ë³¸ ë°°ì—´ì—ì„œì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
                const originalIndex = wordSets.findIndex(s => s.fileName === set.fileName);
                return `
                <div class="file-item" onclick="toggleFileSelection(${originalIndex}, event)">
                    <input type="checkbox" id="file_${originalIndex}" onclick="event.stopPropagation()">
                    <div class="file-item-info">
                        <div class="file-item-name">${set.fileName}</div>
                        <div class="file-item-count">${set.words.length}ê°œ ë‹¨ì–´</div>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        // íŒŒì¼ ì„ íƒ í† ê¸€
        function toggleFileSelection(index, event) {
            // ì²´í¬ë°•ìŠ¤ ì§ì ‘ í´ë¦­í•œ ê²½ìš°ëŠ” ì´ë¯¸ í† ê¸€ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì•„ë¬´ê²ƒë„ ì•ˆí•¨
            if (event && event.target.type === 'checkbox') {
                // ê³µë¶€í•˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” í•˜ë‚˜ë§Œ ì„ íƒë˜ë„ë¡
                if (studyMode === 'study') {
                    const checkbox = event.target;
                    if (checkbox.checked) {
                        // ë‹¤ë¥¸ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
                        wordSets.forEach((_, i) => {
                            if (i !== index) {
                                document.getElementById(`file_${i}`).checked = false;
                            }
                        });
                    }
                }
                return;
            }
            
            const checkbox = document.getElementById(`file_${index}`);
            
            // ê³µë¶€í•˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” í•˜ë‚˜ë§Œ ì„ íƒë˜ë„ë¡
            if (studyMode === 'study') {
                if (checkbox.checked) {
                    // ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ì œ
                    checkbox.checked = false;
                } else {
                    // ë‹¤ë¥¸ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ í›„ í˜„ì¬ ê²ƒë§Œ ì„ íƒ
                    wordSets.forEach((_, i) => {
                        document.getElementById(`file_${i}`).checked = false;
                    });
                    checkbox.checked = true;
                }
            } else {
                // í‰ê°€í•˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” ê¸°ì¡´ëŒ€ë¡œ í† ê¸€
            checkbox.checked = !checkbox.checked;
            }
        }
        
        // ì „ì²´ ì„ íƒ
        function selectAll() {
            // ê³µë¶€í•˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” ì „ì²´ ì„ íƒ ë¶ˆê°€
            if (studyMode === 'study') {
                alert('ê³µë¶€í•˜ê¸° ëª¨ë“œì—ì„œëŠ” í•˜ë‚˜ì˜ ë‹¨ì–´ë¬¶ìŒë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            wordSets.forEach((_, index) => {
                document.getElementById(`file_${index}`).checked = true;
            });
        }
        
        // ì „ì²´ í•´ì œ
        function deselectAll() {
            wordSets.forEach((_, index) => {
                document.getElementById(`file_${index}`).checked = false;
            });
        }
        
        // í•™ìŠµ ì‹œì‘
        function startStudy() {
            selectedWords = [];
            selectedQuestions = [];
            let selectedFileCount = 0;
            let selectedSet = null;
            
            wordSets.forEach((set, index) => {
                const checkbox = document.getElementById(`file_${index}`);
                if (checkbox && checkbox.checked) {
                    selectedFileCount++;
                    selectedSet = set;
                    set.words.forEach(word => {
                        const wordData = {
                            ...word,
                            fileName: set.fileName,
                            weightKey: `${set.fileName}_${word.id}`
                        };
                        selectedWords.push(wordData);
                        
                        // í‰ê°€í•˜ê¸° ëª¨ë“œì¼ ë•Œ ê° ë‹¨ì–´ì— ëŒ€í•´ 2ê°œì˜ ë¬¸ì œ ìƒì„±
                        if (studyMode === 'quiz') {
                            // ì¼ë³¸ì–´ í‘œê¸° ë¬¸ì œ
                            selectedQuestions.push({
                                word: wordData,
                                questionType: 'japanese',
                                questionLabel: 'ì¼ë³¸ì–´ í‘œê¸°',
                                weightKey: `${set.fileName}_${word.id}_japanese`
                            });
                            // ì˜ë¯¸ ë¬¸ì œ
                            selectedQuestions.push({
                                word: wordData,
                                questionType: 'meaning',
                                questionLabel: 'ëœ»',
                                weightKey: `${set.fileName}_${word.id}_meaning`
                            });
                        }
                    });
                }
            });
            
            if (selectedWords.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ë‹¨ì–´ë¬¶ìŒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê³µë¶€í•˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” í•˜ë‚˜ì˜ íŒŒì¼ë§Œ ì„ íƒë˜ì–´ì•¼ í•¨
            if (studyMode === 'study' && selectedFileCount > 1) {
                alert('ê³µë¶€í•˜ê¸° ëª¨ë“œì—ì„œëŠ” í•˜ë‚˜ì˜ ë‹¨ì–´ë¬¶ìŒë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentWordIndex = -1;
            wordHistory = [];
            weights = {}; // ê°€ì¤‘ì¹˜ ì´ˆê¸°í™” (ì„¸ì…˜ ì¤‘ì—ë§Œ ì‚¬ìš©)
            
            if (studyMode === 'quiz') {
                // í‰ê°€í•˜ê¸° ëª¨ë“œ: ê° ë¬¸ì œì˜ ê°€ì¤‘ì¹˜ë¥¼ 1ë¡œ ì´ˆê¸°í™”
                selectedQuestions.forEach(question => {
                    weights[question.weightKey] = 1;
                });
            } else {
                // ê³µë¶€í•˜ê¸° ëª¨ë“œ: ì„ íƒëœ ë‹¨ì–´ë“¤ì˜ ê°€ì¤‘ì¹˜ë¥¼ 1ë¡œ ì´ˆê¸°í™”
                selectedWords.forEach(word => {
                    weights[word.weightKey] = 1;
                });
            }
            
            document.getElementById('fileSelectionScreen').classList.add('hidden');
            document.getElementById('homeBtn').classList.remove('hidden');
            document.getElementById('changeSetBtn').classList.remove('hidden');
            
            if (studyMode === 'study') {
                // ê³µë¶€í•˜ê¸° ëª¨ë“œ: í…Œì´ë¸” í™”ë©´ í‘œì‹œ
                displayStudyTable(selectedSet);
                document.getElementById('studyTableScreen').classList.remove('hidden');
                document.getElementById('settingsBtn').classList.add('hidden');
                document.getElementById('changeSetBtn').classList.add('hidden');
                document.getElementById('startQuizBtn').classList.remove('hidden');
            } else {
                // í‰ê°€í•˜ê¸° ëª¨ë“œ: í”Œë˜ì‹œì¹´ë“œ í™”ë©´ í‘œì‹œ
                document.getElementById('flashcardScreen').classList.remove('hidden');
                document.getElementById('settingsBtn').classList.remove('hidden');
                document.getElementById('startQuizBtn').classList.add('hidden');
                updateProgress(); // ì´ˆê¸° ì§„í–‰ë„ ì„¤ì •
                nextCard();
            }
        }
        
        // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ëœë¤ ë¬¸ì œ ì„ íƒ (í‰ê°€í•˜ê¸° ëª¨ë“œ)
        function getWeightedRandomQuestion() {
            // ê°€ì¤‘ì¹˜ê°€ 1 ì´ìƒì¸ ë¬¸ì œë§Œ ì„ íƒ ëŒ€ìƒì— í¬í•¨
            let availableQuestions = selectedQuestions.filter(question => {
                const weight = weights[question.weightKey];
                return weight !== undefined && weight > 0;
            });
            
            if (availableQuestions.length === 0) {
                return null; // ëª¨ë“  ë¬¸ì œê°€ ì™„ë£Œë¨
            }
            
            // ìµœê·¼ 5ê°œ ë‹¨ì–´ ì œì™¸ ë¡œì§ (ë‚¨ì€ ë‹¨ì–´ê°€ 5ê°œ ì´ˆê³¼ì¼ ë•Œë§Œ ì ìš©)
            const RECENT_WORD_COUNT = 5;
            if (availableQuestions.length > RECENT_WORD_COUNT && wordHistory.length > 0) {
                // wordHistoryì—ì„œ ìµœê·¼ 5ê°œ í•­ëª©ì˜ ë‹¨ì–´ ì‹ë³„ì ì¶”ì¶œ
                const recentWords = new Set();
                const recentHistory = wordHistory.slice(-RECENT_WORD_COUNT);
                
                recentHistory.forEach(item => {
                    // fileNameê³¼ idë¥¼ ì¡°í•©í•˜ì—¬ ë‹¨ì–´ ì‹ë³„ì ìƒì„±
                    if (item.fileName && item.id !== undefined) {
                        const wordKey = `${item.fileName}_${item.id}`;
                        recentWords.add(wordKey);
                    }
                });
                
                // ìµœê·¼ 5ê°œ ë‹¨ì–´ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œë“¤ì„ ì œì™¸
                const filteredQuestions = availableQuestions.filter(question => {
                    if (question.word && question.word.fileName && question.word.id !== undefined) {
                        const wordKey = `${question.word.fileName}_${question.word.id}`;
                        return !recentWords.has(wordKey);
                    }
                    return true; // fileNameì´ë‚˜ idê°€ ì—†ìœ¼ë©´ í¬í•¨
                });
                
                // í•„í„°ë§ í›„ ë‚¨ì€ ë¬¸ì œê°€ 5ê°œ ì´ˆê³¼ì´ë©´ í•„í„°ë§ëœ ê²°ê³¼ ì‚¬ìš©
                // 5ê°œ ì´í•˜ë©´ ì›ë˜ availableQuestions ì‚¬ìš© (ì¤‘ë³µ ë°©ì§€ ë¹„í™œì„±í™”)
                if (filteredQuestions.length > RECENT_WORD_COUNT) {
                    availableQuestions = filteredQuestions;
                }
                // filteredQuestions.length <= RECENT_WORD_COUNTì¸ ê²½ìš°ëŠ” ì›ë˜ availableQuestions ì‚¬ìš©
            }
            
            const totalWeight = availableQuestions.reduce((sum, question) => {
                return sum + weights[question.weightKey];
            }, 0);
            
            if (totalWeight === 0) {
                return null; // ëª¨ë“  ë¬¸ì œê°€ ì™„ë£Œë¨
            }
            
            let random = Math.random() * totalWeight;
            
            for (let question of availableQuestions) {
                const weight = weights[question.weightKey];
                random -= weight;
                if (random <= 0) {
                    return question;
                }
            }
            
            return availableQuestions[0];
        }
        
        // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ëœë¤ ë‹¨ì–´ ì„ íƒ (ê³µë¶€í•˜ê¸° ëª¨ë“œ)
        function getWeightedRandomWord() {
            const totalWeight = selectedWords.reduce((sum, word) => {
                return sum + (weights[word.weightKey] || 1);
            }, 0);
            
            let random = Math.random() * totalWeight;
            
            for (let word of selectedWords) {
                const weight = weights[word.weightKey] || 1;
                random -= weight;
                if (random <= 0) {
                    return word;
                }
            }
            
            return selectedWords[0];
        }
        
        // ë‹¤ìŒ ì¹´ë“œ
        function nextCard() {
            // ìŠ¤íƒ ë°©ì‹: í˜„ì¬ ìœ„ì¹˜ ì´í›„ì˜ íˆìŠ¤í† ë¦¬ ì œê±° (ì´ì „ìœ¼ë¡œ ê°”ë‹¤ê°€ ë‹¤ì‹œ ë‹¤ìŒì„ ëˆ„ë¥¸ ê²½ìš°)
            const isGoingBackThenForward = currentWordIndex < wordHistory.length - 1;
            
            // ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ (ì´ì „ì—ì„œ ë‹¤ìŒìœ¼ë¡œ ê°€ëŠ” ê²½ìš°ëŠ” ê°€ì¤‘ì¹˜ ë³€í™” ì—†ìŒ)
            if (currentWordIndex >= 0 && !isGoingBackThenForward) {
                const currentItem = wordHistory[currentWordIndex];
                if (studyMode === 'study') {
                    // ê³µë¶€í•˜ê¸° ëª¨ë“œ: í•­ìƒ ê°€ì¤‘ì¹˜ ì¦ê°€
                    weights[currentItem.weightKey] = Math.min(5, (weights[currentItem.weightKey] || 1) + 1);
                } else {
                    // í‰ê°€í•˜ê¸° ëª¨ë“œ
                    if (!answerShown) {
                        // ì •ë‹µ í™•ì¸ ì—†ì´ ë„˜ì–´ê°: ê°€ì¤‘ì¹˜ -1 (ìµœì†Œ 0)
                        weights[currentItem.weightKey] = Math.max(0, (weights[currentItem.weightKey] || 1) - 1);
                    } else {
                        // ì •ë‹µ í™•ì¸ í›„ ë„˜ì–´ê°: ê°€ì¤‘ì¹˜ +1 (ìµœëŒ€ 5)
                        weights[currentItem.weightKey] = Math.min(5, (weights[currentItem.weightKey] || 1) + 1);
                    }
                }
            }
            
            // ìŠ¤íƒ ë°©ì‹: í˜„ì¬ ìœ„ì¹˜ ì´í›„ì˜ íˆìŠ¤í† ë¦¬ ì œê±°
            if (isGoingBackThenForward) {
                wordHistory = wordHistory.slice(0, currentWordIndex + 1);
            }
            
            if (studyMode === 'quiz') {
                // í‰ê°€í•˜ê¸° ëª¨ë“œ: ë¬¸ì œ ì„ íƒ
                const newQuestion = getWeightedRandomQuestion();
                if (!newQuestion) {
                    // ëª¨ë“  ë¬¸ì œ ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ í›„ ì²˜ìŒìœ¼ë¡œ ì´ë™
                    alert('í•™ìŠµì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤!');
                    goHome();
                    return;
                }
                
                // ë¬¸ì œ ê°ì²´ ìƒì„±
                const questionItem = {
                    ...newQuestion.word,
                    questionType: newQuestion.questionType,
                    questionLabel: newQuestion.questionLabel,
                    weightKey: newQuestion.weightKey
                };
                
                wordHistory.push(questionItem);
                currentWordIndex = wordHistory.length - 1;
            } else {
                // ê³µë¶€í•˜ê¸° ëª¨ë“œ: ë‹¨ì–´ ì„ íƒ
                const newWord = getWeightedRandomWord();
                wordHistory.push(newWord);
                currentWordIndex = wordHistory.length - 1;
            }
            
            displayCard();
            updateButtons();
            updateProgress();
        }
        
        // ì´ì „ ì¹´ë“œ
        function previousCard() {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                displayCard();
                updateButtons();
            }
        }
        
        // ì¹´ë“œ í‘œì‹œ
        function displayCard() {
            const item = wordHistory[currentWordIndex];
            answerShown = false;
            
            // í˜„ì¬ í•­ëª©ì˜ ê°€ì¤‘ì¹˜ í‘œì‹œ
            const weightKey = item.weightKey;
            const currentWeight = weights[weightKey] || 1;
            document.getElementById('weightValue').textContent = currentWeight;
            
            if (studyMode === 'study') {
                // ê³µë¶€í•˜ê¸° ëª¨ë“œ: ëª¨ë“  ì •ë³´ í‘œì‹œ
                displayStudyMode(item);
            } else {
                // í‰ê°€í•˜ê¸° ëª¨ë“œ: ì €ì¥ëœ ë¬¸ì œ í‘œì‹œ
                displayQuizMode(item);
            }
            
            updateProgress();
        }
        
        // í‰ê°€í•˜ê¸° ëª¨ë“œ í‘œì‹œ
        function displayQuizMode(word) {
            // ë°œìŒì´ ìˆëŠ”ì§€ í™•ì¸ (ë¹ˆ ë¬¸ìì—´ì´ê±°ë‚˜ ì—†ëŠ” ê²½ìš° ì œì™¸)
            const hasPronunciation = word.pronunciation && word.pronunciation.trim() !== '';
            
            // íˆìŠ¤í† ë¦¬ì— ì €ì¥ëœ ë¬¸ì œ ìœ í˜•ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ëœë¤ ì„ íƒ
            if (word.questionType && word.questionLabel) {
                // ì €ì¥ëœ ë¬¸ì œ ìœ í˜• ì‚¬ìš©
                currentQuestion = {
                    type: word.questionType,
                    label: word.questionLabel,
                    value: word[word.questionType] // word.japanese ë˜ëŠ” word.meaning
                };
            } else {
                // ëœë¤ìœ¼ë¡œ ë¬¸ì œ ìœ í˜• ì„ íƒ (ë°œìŒ ë¬¸ì œëŠ” ì œì™¸)
                const questionTypes = [
                    { type: 'japanese', label: 'ì¼ë³¸ì–´ í‘œê¸°', value: word.japanese },
                    { type: 'meaning', label: 'ëœ»', value: word.meaning }
                ];
                
                const randomIndex = Math.floor(Math.random() * questionTypes.length);
                currentQuestion = questionTypes[randomIndex];
                
                // ì €ì¥ (ë‹¤ìŒì— ê°™ì€ ë‹¨ì–´ë¥¼ ë³¼ ë•Œ ì‚¬ìš©)
                word.questionType = currentQuestion.type;
                word.questionLabel = currentQuestion.label;
            }
            
            document.getElementById('questionType').textContent = currentQuestion.label;
            document.getElementById('cardContent').textContent = currentQuestion.value;
            document.getElementById('cardContent').style.fontSize = '48px';
            
            // ë‹µ ë¶€ë¶„ë„ ë¯¸ë¦¬ ë Œë”ë§í•˜ë˜ hiddenìœ¼ë¡œ ì„¤ì • (ì¹´ë“œ ë†’ì´ ìœ ì§€)
            const answers = [];
            if (currentQuestion.type !== 'japanese') {
                answers.push({ label: 'ì¼ë³¸ì–´ í‘œê¸°', value: word.japanese });
            }
            if (currentQuestion.type !== 'pronunciation' && hasPronunciation) {
                answers.push({ label: 'ë°œìŒ', value: word.pronunciation });
            }
            if (currentQuestion.type !== 'meaning') {
                answers.push({ label: 'ëœ»', value: word.meaning });
            }
            
            const answerHTML = answers.map(ans => `
                <div class="card-answer-item">
                    <div class="card-answer-label">${ans.label}</div>
                    <div class="card-answer-value">${ans.value}</div>
                </div>
            `).join('');
            
            document.getElementById('cardAnswer').innerHTML = answerHTML;
            document.getElementById('cardAnswer').classList.add('hidden');
            document.getElementById('showAnswerBtn').classList.remove('hidden');
            document.getElementById('showAnswerBtn').textContent = '?';
            answerShown = false; // ì •ë‹µ í‘œì‹œ ìƒíƒœ ì´ˆê¸°í™”
        }
        
        // Web Speech APIë¡œ ë°œìŒ ì¬ìƒ (Chromeì—ì„œ Google ì¼ë³¸ì–´ ìŒì„± ì‚¬ìš©)
        let jaVoice = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¼ë³¸ì–´ ìŒì„± ì°¾ê¸°
        function initVoices() {
            const setVoice = () => {
                const voices = speechSynthesis.getVoices();
                // Google ì¼ë³¸ì–´ ìŒì„± ìš°ì„ , ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì¼ë³¸ì–´ ìŒì„± ì‚¬ìš©
                jaVoice = voices.find(v => v.name === 'Google æ—¥æœ¬èª') 
                       || voices.find(v => v.lang.startsWith('ja'));
            };
            
            setVoice();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = setVoice;
            }
        }
        
        function playPronunciation(text) {
            if (!text || text.trim() === '') {
                return;
            }
            
            // ì´ì „ ë°œí™” ì¤‘ë‹¨
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            
            if (jaVoice) {
                utterance.voice = jaVoice;
            }
            
            utterance.rate = 0.9;  // ì•½ê°„ ëŠë¦¬ê²Œ (í•™ìŠµìš©)
            utterance.pitch = 1;
            
            utterance.onerror = (e) => {
                console.error('ë°œìŒ ì¬ìƒ ì‹¤íŒ¨:', e);
            };
            
            speechSynthesis.speak(utterance);
        }
        
        // ê³µë¶€í•˜ê¸° í…Œì´ë¸” í‘œì‹œ
        function displayStudyTable(wordSet) {
            const container = document.getElementById('studyTableContainer');
            
            const infoHTML = `
                <div class="study-table-info">
                    ê° í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ë³´ì„/ìˆ¨ê¹€ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </div>
            `;
            
            const tableHTML = `
                <table class="study-table">
                    <thead>
                        <tr>
                            <th class="id-cell">ID</th>
                            <th class="play-cell">ì¬ìƒ</th>
                            <th class="japanese-cell" onclick="toggleColumn('japanese')">ì¼ë³¸ì–´ í‘œê¸°</th>
                            <th class="pronunciation-cell" onclick="toggleColumn('pronunciation')">ë°œìŒ</th>
                            <th class="meaning-cell" onclick="toggleColumn('meaning')">ì˜ë¯¸</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${wordSet.words.map((word, index) => {
                            // ë°œìŒì´ ìˆìœ¼ë©´ ë°œìŒì„, ì—†ìœ¼ë©´ ì¼ë³¸ì–´ í‘œê¸°ë¥¼ ì‚¬ìš©
                            const textToSpeak = word.pronunciation && word.pronunciation.trim() !== '' 
                                ? word.pronunciation 
                                : word.japanese;
                            return `
                            <tr>
                                <td class="id-cell">${word.id}</td>
                                <td class="play-cell">
                                    <button class="play-button" onclick="playPronunciation('${textToSpeak.replace(/'/g, "\\'")}')" title="ë°œìŒ ì¬ìƒ">â–¶</button>
                                </td>
                                <td class="japanese-cell" onclick="toggleCell(this)">${word.japanese}</td>
                                <td class="pronunciation-cell" onclick="toggleCell(this)">${word.pronunciation}</td>
                                <td class="meaning-cell" onclick="toggleCell(this)">${word.meaning}</td>
                            </tr>
                        `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = infoHTML + tableHTML;
        }
        
        // ì…€ í´ë¦­ ì‹œ í…ìŠ¤íŠ¸ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleCell(cell) {
            cell.classList.toggle('hidden-text');
        }
        
        // í—¤ë” í´ë¦­ ì‹œ í•´ë‹¹ ì»¬ëŸ¼ ì „ì²´ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleColumn(columnType) {
            const cells = document.querySelectorAll(`.study-table tbody .${columnType}-cell`);
            const allHidden = Array.from(cells).every(cell => cell.classList.contains('hidden-text'));
            
            cells.forEach(cell => {
                if (allHidden) {
                    // ëª¨ë‘ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ëª¨ë‘ ë³´ì´ê²Œ
                    cell.classList.remove('hidden-text');
                } else {
                    // í•˜ë‚˜ë¼ë„ ë³´ì´ë©´ ëª¨ë‘ ìˆ¨ê¸°ê¸°
                    cell.classList.add('hidden-text');
                }
            });
        }
        
        // ê³µë¶€í•˜ê¸° ëª¨ë“œ í‘œì‹œ (í‰ê°€í•˜ê¸° ëª¨ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ - ìœ ì§€)
        function displayStudyMode(word) {
            currentQuestion = { type: 'all' }; // ëª¨ë“  ì •ë³´ í‘œì‹œ
            
            document.getElementById('questionType').textContent = 'ê³µë¶€í•˜ê¸°';
            
            const studyHTML = `
                <div class="study-mode-card">
                    <div class="study-item main">
                        <div class="study-item-label">ì¼ë³¸ì–´ í‘œê¸°</div>
                        <div class="study-item-value">${word.japanese}</div>
                    </div>
                    <div class="study-item">
                        <div class="study-item-label">ë°œìŒ</div>
                        <div class="study-item-value">${word.pronunciation}</div>
                    </div>
                    <div class="study-item">
                        <div class="study-item-label">ëœ»</div>
                        <div class="study-item-value">${word.meaning}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('cardContent').innerHTML = studyHTML;
            document.getElementById('cardContent').style.fontSize = 'inherit';
            document.getElementById('cardAnswer').classList.add('hidden');
            document.getElementById('showAnswerBtn').classList.add('hidden');
            document.getElementById('nextBtn').textContent = 'ë‹¤ìŒìœ¼ë¡œ';
        }
        
        // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            if (studyMode !== 'quiz' || selectedQuestions.length === 0) {
                return;
            }
            
            const totalQuestions = selectedQuestions.length;
            const completedQuestions = selectedQuestions.filter(question => {
                const weight = weights[question.weightKey];
                return weight !== undefined && weight === 0;
            }).length;
            
            document.getElementById('progressValue').textContent = `${completedQuestions} / ${totalQuestions}`;
        }
        
        // ì •ë‹µ í™•ì¸/ìˆ¨ê¸°ê¸° í† ê¸€
        function showAnswer() {
            const cardAnswer = document.getElementById('cardAnswer');
            const showAnswerBtn = document.getElementById('showAnswerBtn');
            
            if (answerShown) {
                // ì •ë‹µì´ ë³´ì—¬ì ¸ ìˆìœ¼ë©´ ìˆ¨ê¸°ê¸°
                cardAnswer.classList.add('hidden');
                showAnswerBtn.textContent = '?';
                answerShown = false;
            } else {
                // ì •ë‹µì´ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ë³´ì—¬ì£¼ê¸°
                cardAnswer.classList.remove('hidden');
                showAnswerBtn.textContent = 'âœ“';
                answerShown = true;
                // ê°€ì¤‘ì¹˜ëŠ” nextCard()ì—ì„œë§Œ ë³€ê²½
            }
        }
        
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentWordIndex === 0;
        }
        
        // ì²˜ìŒìœ¼ë¡œ
        function goHome() {
            document.getElementById('flashcardScreen').classList.add('hidden');
            document.getElementById('studyTableScreen').classList.add('hidden');
            document.getElementById('fileSelectionScreen').classList.remove('hidden');
            document.getElementById('homeBtn').classList.add('hidden');
            document.getElementById('changeSetBtn').classList.add('hidden');
            document.getElementById('startQuizBtn').classList.add('hidden');
            document.getElementById('settingsBtn').classList.add('hidden');
            
            // ëª¨ë“œ ì´ˆê¸°í™”
            studyMode = 'quiz';
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('selected');
            });
            // í‰ê°€í•˜ê¸° ëª¨ë“œê°€ ê¸°ë³¸ ì„ íƒë˜ë„ë¡ ì„¤ì •
            const quizOption = document.querySelector('.mode-option[onclick*="quiz"]');
            if (quizOption) {
                quizOption.classList.add('selected');
            }
            // ë¼ë””ì˜¤ ë²„íŠ¼ë„ ì´ˆê¸°í™”
            const quizRadio = document.querySelector('input[value="quiz"]');
            const studyRadio = document.querySelector('input[value="study"]');
            if (quizRadio) quizRadio.checked = true;
            if (studyRadio) studyRadio.checked = false;
            
            // ì²´í¬ë°•ìŠ¤ í•´ì œ
            deselectAll();
        }
        
        // ê³µë¶€í•˜ê¸°ì—ì„œ í‰ê°€í•˜ê¸°ë¡œ ì „í™˜
        function startQuizFromStudy() {
            // í˜„ì¬ ì„ íƒëœ ë‹¨ì–´ì…‹ìœ¼ë¡œ í‰ê°€í•˜ê¸° ëª¨ë“œ ì‹œì‘
            selectedQuestions = [];
            
            // í˜„ì¬ ì„ íƒëœ ë‹¨ì–´ë“¤ë¡œ ë¬¸ì œ ìƒì„±
            selectedWords.forEach(word => {
                // ì¼ë³¸ì–´ í‘œê¸° ë¬¸ì œ
                selectedQuestions.push({
                    word: word,
                    questionType: 'japanese',
                    questionLabel: 'ì¼ë³¸ì–´ í‘œê¸°',
                    weightKey: `${word.fileName}_${word.id}_japanese`
                });
                // ì˜ë¯¸ ë¬¸ì œ
                selectedQuestions.push({
                    word: word,
                    questionType: 'meaning',
                    questionLabel: 'ëœ»',
                    weightKey: `${word.fileName}_${word.id}_meaning`
                });
            });
            
            // ê°€ì¤‘ì¹˜ ì´ˆê¸°í™”: ê° ë¬¸ì œì˜ ê°€ì¤‘ì¹˜ë¥¼ 1ë¡œ ì„¤ì •
            weights = {};
            selectedQuestions.forEach(question => {
                weights[question.weightKey] = 1;
            });
            
            // ëª¨ë“œ ë³€ê²½
            studyMode = 'quiz';
            
            // í™”ë©´ ì „í™˜
            document.getElementById('studyTableScreen').classList.add('hidden');
            document.getElementById('flashcardScreen').classList.remove('hidden');
            document.getElementById('startQuizBtn').classList.add('hidden');
            document.getElementById('changeSetBtn').classList.remove('hidden');
            document.getElementById('settingsBtn').classList.remove('hidden');
            
            // í•™ìŠµ ìƒíƒœ ì´ˆê¸°í™”
            currentWordIndex = -1;
            wordHistory = [];
            
            // í‰ê°€í•˜ê¸° ëª¨ë“œ ì‹œì‘
            updateProgress();
            nextCard();
        }
        
        // ë‹¨ì–´ì…‹ ë³€ê²½
        function changeWordSet() {
            if (confirm('í˜„ì¬ í•™ìŠµì„ ì¤‘ë‹¨í•˜ê³  ë‹¨ì–´ì…‹ì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('flashcardScreen').classList.add('hidden');
                document.getElementById('studyTableScreen').classList.add('hidden');
                document.getElementById('fileSelectionScreen').classList.remove('hidden');
                document.getElementById('changeSetBtn').classList.add('hidden');
                document.getElementById('startQuizBtn').classList.add('hidden');
                document.getElementById('settingsBtn').classList.add('hidden');
            }
        }
        
        // ë²„íŠ¼ ì •ë ¬ ë©”ë‰´ í† ê¸€
        function toggleAlignmentMenu() {
            const menu = document.getElementById('alignmentMenu');
            menu.classList.toggle('show');
        }
        
        // ë²„íŠ¼ ì •ë ¬ ì„¤ì •
        function setButtonAlignment(alignment) {
            buttonAlignment = alignment;
            const cardControls = document.getElementById('cardControls');
            const menu = document.getElementById('alignmentMenu');
            const options = menu.querySelectorAll('.alignment-option');
            
            // ëª¨ë“  ì˜µì…˜ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            options.forEach(option => option.classList.remove('active'));
            
            // ì„ íƒí•œ ì˜µì…˜ì— active í´ë˜ìŠ¤ ì¶”ê°€
            if (alignment === 'left') {
                cardControls.className = 'card-controls align-left';
                options[0].classList.add('active');
            } else if (alignment === 'center') {
                cardControls.className = 'card-controls align-center';
                options[1].classList.add('active');
            } else if (alignment === 'right') {
                cardControls.className = 'card-controls align-right';
                options[2].classList.add('active');
            }
            
            // ë©”ë‰´ ë‹«ê¸°
            menu.classList.remove('show');
        }
        
        // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('alignmentMenu');
            const settingsBtn = document.getElementById('settingsBtn');
            
            if (menu && settingsBtn && !menu.contains(event.target) && !settingsBtn.contains(event.target)) {
                menu.classList.remove('show');
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>